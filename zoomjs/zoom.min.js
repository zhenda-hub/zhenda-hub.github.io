+function(a){"use strict";function c(){this._activeZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null,this._$document=a(document),this._$window=a(window),this._$body=a(document.body),this._boundClick=a.proxy(this._clickHandler,this)}c.prototype.listen=function(){this._$body.on('click','[data-action="zoom"]',a.proxy(this._zoom,this))},c.prototype._zoom=function(c){var d=c.target;if(!d||d.tagName!='IMG')return;if(this._$body.hasClass('zoom-overlay-open'))return;if(c.metaKey||c.ctrlKey)return window.open(c.target.getAttribute('data-original')||c.target.src,'_blank');if(d.width>=a(window).width()-b.OFFSET)return;this._activeZoomClose(!0),this._activeZoom=new b(d),this._activeZoom.zoomImage(),this._$window.on('scroll.zoom',a.proxy(this._scrollHandler,this)),this._$document.on('keyup.zoom',a.proxy(this._keyHandler,this)),this._$document.on('touchstart.zoom',a.proxy(this._touchStart,this)),document.addEventListener?document.addEventListener('click',this._boundClick,!0):document.attachEvent('onclick',this._boundClick,!0),'bubbles'in c?c.bubbles&&c.stopPropagation():c.cancelBubble=!0},c.prototype._activeZoomClose=function(a){if(!this._activeZoom)return;a?this._activeZoom.dispose():this._activeZoom.close(),this._$window.off('.zoom'),this._$document.off('.zoom'),document.removeEventListener('click',this._boundClick,!0),this._activeZoom=null},c.prototype._scrollHandler=function(c){this._initialScrollPosition===null&&(this._initialScrollPosition=a(window).scrollTop());var b=this._initialScrollPosition-a(window).scrollTop();Math.abs(b)>=40&&this._activeZoomClose()},c.prototype._keyHandler=function(a){a.keyCode==27&&this._activeZoomClose()},c.prototype._clickHandler=function(a){a.preventDefault?a.preventDefault():event.returnValue=!1,'bubbles'in a?a.bubbles&&a.stopPropagation():a.cancelBubble=!0,this._activeZoomClose()},c.prototype._touchStart=function(b){this._initialTouchPosition=b.touches[0].pageY,a(b.target).on('touchmove.zoom',a.proxy(this._touchMove,this))},c.prototype._touchMove=function(b){Math.abs(b.touches[0].pageY-this._initialTouchPosition)>10&&(this._activeZoomClose(),a(b.target).off('touchmove.zoom'))};function b(b){this._fullHeight=this._fullWidth=this._overlay=this._targetImageWrap=null,this._targetImage=b,this._$body=a(document.body)}b.OFFSET=80,b._MAX_WIDTH=2560,b._MAX_HEIGHT=4096,b.prototype.zoomImage=function(){var b=document.createElement('img');b.onload=a.proxy(function(){this._fullHeight=Number(b.height),this._fullWidth=Number(b.width),this._zoomOriginal()},this),b.src=this._targetImage.src},b.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement('div'),this._targetImageWrap.className='zoom-img-wrap',this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),a(this._targetImage).addClass('zoom-img').attr('data-action','zoom-out'),this._overlay=document.createElement('div'),this._overlay.className='zoom-overlay',document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation()},b.prototype._calculateZoom=function(){var c,d,j,e,f,g,h,i;this._targetImage.offsetWidth,c=this._fullWidth,d=this._fullHeight,j=a(window).scrollTop(),e=c/this._targetImage.width,f=a(window).height()-b.OFFSET,g=a(window).width()-b.OFFSET,h=c/d,i=g/f,c<g&&d<f?this._imgScaleFactor=e:h<i?this._imgScaleFactor=f/d*e:this._imgScaleFactor=g/c*e},b.prototype._triggerAnimation=function(){var d,i,e,f,g,h,c,b;this._targetImage.offsetWidth,d=a(this._targetImage).offset(),i=a(window).scrollTop(),e=i+a(window).height()/2,f=a(window).width()/2,g=d.top+this._targetImage.height/2,h=d.left+this._targetImage.width/2,this._translateY=e-g,this._translateX=f-h,c='scale('+this._imgScaleFactor+')',b='translate('+this._translateX+'px, '+this._translateY+'px)',a.support.transition&&(b+=' translateZ(0)'),a(this._targetImage).css({'-webkit-transform':c,'-ms-transform':c,transform:c}),a(this._targetImageWrap).css({'-webkit-transform':b,'-ms-transform':b,transform:b}),this._$body.addClass('zoom-overlay-open')},b.prototype.close=function(){if(this._$body.removeClass('zoom-overlay-open').addClass('zoom-overlay-transitioning'),a(this._targetImage).css({'-webkit-transform':'','-ms-transform':'',transform:''}),a(this._targetImageWrap).css({'-webkit-transform':'','-ms-transform':'',transform:''}),!a.support.transition)return this.dispose();a(this._targetImage).one(a.support.transition.end,a.proxy(this.dispose,this)).emulateTransitionEnd(300)},b.prototype.dispose=function(){this._targetImageWrap&&this._targetImageWrap.parentNode&&(a(this._targetImage).removeClass('zoom-img').attr('data-action','zoom'),this._targetImageWrap.parentNode.replaceChild(this._targetImage,this._targetImageWrap),this._overlay.parentNode.removeChild(this._overlay),this._$body.removeClass('zoom-overlay-transitioning'))},a(function(){(new c).listen()})}(jQuery)