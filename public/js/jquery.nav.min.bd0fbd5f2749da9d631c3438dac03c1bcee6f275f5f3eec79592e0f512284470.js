(function(a,c,d,e){var b=function(b,e){this.elem=b,this.$elem=a(b),this.options=e,this.metadata=this.$elem.data('plugin-options'),this.$win=a(c),this.sections={},this.didScroll=!1,this.$doc=a(d),this.docHeight=this.$doc.height()};b.prototype={defaults:{navItems:'a',currentClass:'current',changeHash:!1,easing:'swing',filter:'',scrollSpeed:750,scrollThreshold:.5,begin:!1,end:!1,scrollChange:!1,padding:0},init:function(){return this.config=a.extend({},this.defaults,this.options,this.metadata),this.$nav=this.$elem.find(this.config.navItems),this.config.filter!==''&&(this.$nav=this.$nav.filter(this.config.filter)),this.$nav.on('click.onePageNav',a.proxy(this.handleClick,this)),this.getPositions(),this.bindInterval(),this.$win.on('resize.onePageNav',a.proxy(this.getPositions,this)),this},adjustNav:function(a,b){a.$elem.find('.'+a.config.currentClass).removeClass(a.config.currentClass),b.addClass(a.config.currentClass)},bindInterval:function(){var a=this,b;a.$win.on('scroll.onePageNav',function(){a.didScroll=!0}),a.t=setInterval(function(){b=a.$doc.height(),a.didScroll&&(a.didScroll=!1,a.scrollChange()),b!==a.docHeight&&(a.docHeight=b,a.getPositions())},250)},getHash:function(a){return a.attr('href').split('#')[1]},getPositions:function(){var b=this,c,e,d;b.$nav.each(function(){c=b.getHash(a(this)),d=a('#'+c),d.length&&(e=d.offset().top,b.sections[c]=Math.round(e))})},getSection:function(c){var a=null,d=Math.round(this.$win.height()*this.config.scrollThreshold),b;for(b in this.sections)this.sections[b]-d<c&&(a=b);return a},handleClick:function(d){var b=this,e=a(d.currentTarget),f=e.parent(),g='#'+b.getHash(e);f.hasClass(b.config.currentClass)||(b.config.begin&&b.config.begin(),b.adjustNav(b,f),b.unbindInterval(),b.scrollTo(g,function(){b.config.changeHash&&(c.location.hash=g),b.bindInterval(),b.config.end&&b.config.end()})),d.preventDefault()},scrollChange:function(){var c=this.$win.scrollTop(),b=this.getSection(c),a;b!==null&&(a=this.$elem.find('a[href$="#'+b+'"]').parent(),a.hasClass(this.config.currentClass)||(this.adjustNav(this,a),this.config.scrollChange&&this.config.scrollChange(a)))},scrollTo:function(b,c){var d=a(b).offset().top-this.config.padding;a('html, body').animate({scrollTop:d},this.config.scrollSpeed,this.config.easing,c)},unbindInterval:function(){clearInterval(this.t),this.$win.unbind('scroll.onePageNav')}},b.defaults=b.prototype.defaults,a.fn.onePageNav=function(a){return this.each(function(){new b(this,a).init()})}})(jQuery,window,document)